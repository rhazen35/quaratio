<?php
/**
 * Created by PhpStorm.
 * User: Ruben Hazenbosch
 * Date: 28-7-2016
 * Time: 13:59
 */

namespace web\tmp\xmlModel\xmlModelUpload;

use \application\controller;
use application\classes\project;

( new controller\Controller( "class", "project", "project" ) )->request();

$urlData = array( "requestType" => "template", "requestAttribute" => "xmlModelReport", "requestDirectory" => "xmlModel" );
$urlData = base64_encode( json_encode( $urlData ) );

$projectId = ( isset( $_SESSION['projectId'] ) ? $_SESSION['projectId'] : "" );
$params = array( "id" => $projectId );
$projectData = ( new project\Project( "getProjectById" ) )->request( $params );

?>


<div class="modelUpload effect3">
    <div class="project-Title">Model Upload</div>
    <div class="project-Header">
        <p>
            Project <?= $projectData['name']; ?> has been successfully created!
            <br><br>
            A model can be added to the project.
        </p>
    </div>
</div>

<div class="project-form">
<form action="" method="POST" enctype="multipart/form-data" id="newModel">
    <div class="modelUpload-Header">
        <p>
            Choose an XML file, generated by Enterprise Architecture.
            <br>
            A validation report will be shown after uploading.
        </p>
    </div>
    <div class="modelUpload-Upload">
        <input type="file" name="xmlFile" id="xmlFile" value="" title="Kies een xml bestand.">
        <input type="submit" name="xmlFileUploadSubmit" value="Uploaden" title="Upload een xml file naar de parser.">
    </div>
</form>
</div>

<script>
    $("#newModel").submit(function(e) {

        var url = "../application/ajax/xmlModel/xmlModelUpload.php";
        var redirect = "<?= LITENING_SELF.'?data='.$urlData; ?>";
        var file_data = $('#xmlFile').prop('files')[0];
        var form_data = new FormData();
        form_data.append('file', file_data);

        $.ajax({
            type: "POST",
            url: url,
            dataType: "text",
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            success: function(response)
            {
                if(response == "Upload ok"){
                    document.location = redirect;
                } else{
                    $("#ajaxResponse").html(response);
                }
            }
        });

        e.preventDefault();
    });
</script>